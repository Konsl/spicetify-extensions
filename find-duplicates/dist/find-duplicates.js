!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var n,s,l,o,t,e;(n=class{}).loadedIsrcCache=!1,n.loadedLibraryIsrcCache=!1,(s=class{}).loaded=!1,(l=class{}).registeredEntries=[],l.started=!1,(o=class{}).updateRunning=!1,o.reUpdate=!1,t={de:{contextMenuText:"Duplikate anzeigen",errorCouldNotRetrieveISRC:"Felher: ISRC konnte nicht abgerufen werden"},en:{contextMenuText:"View Duplicates",errorCouldNotRetrieveISRC:"Error: Could not retrieve ISRC"}},e=async function(){for(var e;!(null!=Spicetify&&Spicetify.ContextMenu&&null!=Spicetify&&Spicetify.CosmosAsync&&null!=(e=null==Spicetify?void 0:Spicetify.Platform)&&e.History&&null!=Spicetify&&Spicetify.Locale&&null!=Spicetify&&Spicetify.URI);)await new Promise(e=>setTimeout(e,100));const{ContextMenu:t,Platform:i,URI:r}=Spicetify;Spicetify.Platform.LibraryAPI.getEvents().addListener("update",m),m(),a(),window.addEventListener("beforeunload",()=>{localStorage.setItem("find-duplicates:isrc-cache",JSON.stringify(n.isrcCache)),localStorage.setItem("find-duplicates:library-isrc-cache",JSON.stringify(n.libraryIsrcCache))}),new t.Item(g().contextMenuText,async e=>{e=await async function(t){var e=c();if(i=e.find(e=>e[0]==t))return i[1];if(i=d().find(e=>e[0]==t))return i[1];if(!S()){var i=Spicetify.URI.from(t),i=null==i?void 0:i.id;if(i){i=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks/"+encodeURIComponent(i)),i=null==(i=null==i?void 0:i.external_ids)?void 0:i.isrc;if(i)return e.push([t,i]),2e3<e.length&&e.splice(0,e.length-2e3),u(e),i}}}(e[0]);e?i.History.push(`/search/${encodeURIComponent("isrc:"+e)}/tracks`):Spicetify.showNotification(g().errorCouldNotRetrieveISRC,!0)},e=>{return 1==e.length&&(null==(e=r.from(e[0]))?void 0:e.type)==r.Type.TRACK}).register()},(async()=>{await e()})();function c(){var e;return n.loadedIsrcCache||(n.isrcCache=JSON.parse(null!=(e=localStorage.getItem("find-duplicates:isrc-cache"))?e:"[]"),n.loadedIsrcCache=!0),n.isrcCache}function u(e){n.loadedIsrcCache=!0,n.isrcCache=e}function d(){var e;return n.loadedLibraryIsrcCache||(n.libraryIsrcCache=JSON.parse(null!=(e=localStorage.getItem("find-duplicates:library-isrc-cache"))?e:"[]"),n.loadedLibraryIsrcCache=!0),n.libraryIsrcCache}function f(e){n.loadedLibraryIsrcCache=!0,n.libraryIsrcCache=e}function p(){const t=window.webpackChunkopen.push([[Symbol()],{},e=>e]);var e=Object.keys(t.m).map(e=>t(e)).filter(e=>"object"==typeof e).map(e=>{try{return Object.values(e)}catch(e){}}).flat().filter(e=>{return!(null==e||!e.type)&&"function"==typeof e.type&&(e=e.type.toString()).includes("remove-from-library")&&e.includes("add-to-library")&&e.includes("className")&&!e.includes("isEpisode")});1==e.length?(s.heartRendererEntry=e[0],s.heartRenderer=s.heartRendererEntry.type):(s.heartRendererEntry=void 0,s.heartRenderer=void 0),s.loaded=!0}async function y(){var e,t=await v([...new Set(l.registeredEntries.map(e=>e.uri))]);for(const i of l.registeredEntries)i.setState(h(i.uri,null==(e=t.find(e=>e[0]==i.uri))?void 0:e[1])),i.setup=!0;l.started=!1}function h(t,i){var e,r=d().filter(e=>e[1]==i),n=r.some(e=>e[0]==t);let a="";return n?(e=(r.findIndex(e=>e[0]==t)+1)%r.length,a=r[e][0]):0<r.length&&(a=r[0][0]),{count:r.length,saved:n,nextEntry:a}}function a(){s.loaded||p();var e=s.heartRendererEntry;e?(e.type=function(e){const i=e.uri,[r,n]=Spicetify.React.useState({count:0,saved:!1,nextEntry:""});Spicetify.React.useEffect(()=>{const t={uri:i,setState:n,setup:!1};var e;return e=t,l.registeredEntries.push(e),l.started||(l.started=!0,setTimeout(async()=>{var e;if(!S()){var t=l.registeredEntries.filter(e=>!e.setup),i=await v([...new Set(t.map(e=>e.uri))]);for(const r of t)r.setState(h(r.uri,null==(e=i.find(e=>e[0]==r.uri))?void 0:e[1])),r.setup=!0;l.started=!1}},0)),()=>{var e;e=t,0<=(e=l.registeredEntries.indexOf(e))&&l.registeredEntries.splice(e,1)}},[i]);var t=Spicetify.React.useCallback(()=>{var e,t="/collection/tracks?uri="+encodeURIComponent(r.nextEntry);return"/collection/tracks"===(null==(e=Spicetify.Platform.History.location)?void 0:e.pathname)?Spicetify.Platform.History.replace(t):Spicetify.Platform.History.push(t),!1},[r.nextEntry]),a=(s.loaded||p(),s.heartRenderer.apply(this,arguments)),c=r.count-(r.saved?1:0),o=r.saved?"+"+c:c.toString();return Spicetify.React.createElement(Spicetify.React.Fragment,{children:[c?Spicetify.React.createElement("a",{class:"TypeElement-mesto-textSubdued-type",href:"#",onClick:t},o):void 0,a]})},Spicetify.Platform.History.replace(Spicetify.Platform.History.location)):Spicetify.showNotification("Error while attaching save count",!0)}function m(){o.updateRunning?o.reUpdate=!0:async function e(){o.updateRunning=!0;const t=(await Spicetify.Platform.LibraryAPI.getTracks({limit:-1})).items.map(e=>e.uri);let i=d();const r=t.filter(t=>!i.find(e=>e[0]==t));const n=i.filter(e=>!t.includes(e[0])).map(e=>e[0]);i=i.filter(e=>!n.includes(e[0]));for(let e=0;e<r.length;e+=50){const a=r.slice(e,Math.min(e+50,r.length)).map(e=>{return null==(e=Spicetify.URI.from(e))?void 0:e.id}).filter(e=>!!e),c=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks?ids="+encodeURIComponent(a.join(",")))).tracks;i.push(...c.filter(e=>{return null==(e=null==e?void 0:e.external_ids)?void 0:e.isrc}).map(e=>[e.uri,e.external_ids.isrc]))}f(i);(o.reUpdate?(o.reUpdate=!1,e):y)();o.updateRunning=!1}()}function S(){return o.updateRunning}async function v(t){var i=c(),e=d();const r=i.filter(e=>t.includes(e[0]));r.push(...e.filter(e=>t.includes(e[0])));var n=t.filter(t=>!r.find(e=>e[0]==t));for(let e=0;e<n.length;e+=50){var a=n.slice(e,Math.min(e+50,n.length)).map(e=>{return null==(e=Spicetify.URI.from(e))?void 0:e.id}).filter(e=>!!e),a=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks?ids="+encodeURIComponent(a.join(",")))).tracks.filter(e=>{return null==(e=null==e?void 0:e.external_ids)?void 0:e.isrc}).map(e=>[e.uri,e.external_ids.isrc]);r.push(...a),i.push(...a)}return 2e3<i.length&&i.splice(0,i.length-2e3),u(i),r}function g(){var e;return null!=(e=t[Spicetify.Locale._locale])?e:t.en}}();